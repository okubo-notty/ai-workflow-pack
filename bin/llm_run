#!/usr/bin/env bash
# =====================================================
# llm_run: Gemini / OpenCode ローカルCLIラッパー
# APIを使わず、非対話モード対応
# =====================================================

MODE="$1"
PROMPT="$2"

# 最大実行時間 (秒)
MAX_TIMEOUT=300

# -----------------------------
# 実行関数
# -----------------------------
run_cmd() {
  local CMD="$1"
  timeout $MAX_TIMEOUT bash -c "$CMD"
}

case "$MODE" in
  gemini)
    # Gemini CLI 実行 (JSON出力)
    run_cmd "gemini-cli generate --prompt \"\$PROMPT\" --output json"
    ;;
  opencode)
    # OpenCode CLI 実行 (非対話)
    run_cmd "opencode review --prompt \"\$PROMPT\" --non-interactive"
    ;;
  *)
    echo "未知のモード: $MODE" >&2
    exit 1
    ;;
esac